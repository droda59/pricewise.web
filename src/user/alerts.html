<template>
    <require from="./components/add-source"></require>

    <div class="primary-dark" style="color: white;">
        <div class="ui container" style="position: relative;">
            <div class="ui text menu" style="margin: 0; padding: 3em 0;">
                <div class="item">
                    <h1 class="ui header" style="color: white; font-size: 3rem; font-weight: 200;" i18n="alerts.watchedProducts">Watched products</h1>
                </div>
        
                <!--<div class="right item" show.bind="alerts.length">
                    <div class="ui icon input">
                        <input value.bind="searchString &amp; debounce:400" placeholder="Search..." type="text" class="au-target">
                        <i class="search link icon au-target" hide.bind="searchString.length"></i>
                        <i class="remove icon au-target aurelia-hide" show.bind="searchString.length" click.delegate="clearSearch()"></i>
                    </div>
                </div>-->
            </div>
            <div class="ui big circular icon red button au-target" click.delegate="addAlert()" show.bind="alerts.length"
                style="position: absolute; bottom: calc(-0.58571429em); right: 10%;"
                data-analytics-category="alerts"
                data-analytics-action="add">
                <i class="plus icon"></i>
            </div>
        </div>
    </div>

    <div class="primary-light">
        <div class="ui container" show.bind="alerts.length">
            <div class="ui link cards">
                <div class="${alert.isActive ? 'green' : 'inactive'} card" repeat.for="alert of alerts | sort:'title'" style="border-radius: 2px">
                    <div class="content">
                        <i class="right floated red circular button remove icon" click.delegate="removeAlert(alert)"
                            data-analytics-category="alerts"
                            data-analytics-action="remove"></i>
                        <a class="header" route-href="route: alert; params.bind: { alertId: alert.id }">${alert.title}</a>
                        <div class="meta">
                            <small show.bind="alert.isActive" i18n="[prepend]alert.bestDealUpdatedTime">${alert.bestCurrentDeal.modifiedAt | rt}</small>
                            <small hide.bind="alert.isActive" i18n="alert.deactivated">Deactivated</small>
                        </div>
                    </div>
                    <a route-href="route: alert; params.bind: { alertId: alert.id }" class="image">
                        <img class="${alert.isPortaitSize ? 'portrait' : ''} ${alert.isLandscapeSize ? 'landscape' : ''}" src.bind="alert.imageUrl">
                    </a>
                    <div class="extra content">
                        <a href.bind="alert.bestCurrentDeal.productUrl" target="_blank" class="right floated" show.bind="alert.isActive"
                            data-analytics-category="Outbound Link"
                            data-analytics-action="click"
                            data-analytics-label.bind="alert.bestCurrentDeal.originalUrl">
                            ${alert.bestCurrentDeal.price | price}
                            <span i18n="alert.priceAt"></span>
                            <img class="ui avatar image" src="/images/${alert.bestCurrentDeal.source.domain}-small.png">
                            ${alert.bestCurrentDeal.source.name}
                        </a>
                        <a class="right floated primary-action-hover" click.delegate="activateAlert(alert)" hide.bind="alert.isActive"
                            i18n="[append]alert.activate"
                            data-analytics-category="alerts"
                            data-analytics-action="activate">
                            <i class="toggle on icon"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="ui overlay" hide.bind="alerts.length">
            <div style="width: 100%; position: absolute; top: 50%; left: 0;">
                <p style="text-align: center;" i18n="alerts.noAlert">You are not watching any product right now.</p>
                <p style="text-align: center;" i18n="alerts.getStarted">Get started!</p>
                <div style="text-align: center;">
                    <div class="ui primary primary-action button" click.delegate="addAlert()"
                        i18n="[append]alerts.createAlert"
                        data-analytics-category="alerts"
                        data-analytics-action="add">
                        <i class="plus icon"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="ui ${isUpdatingAlert ? 'active': ''} inverted dimmer">
            <div class="ui text loader" i18n="alerts.updating">Updating</div>
        </div>

        <confirmation-modal message="alerts.deleteConfirmation"></confirmation-modal>

        <add-source class="add-source-modal" class-name="${isCreatingAlert ? 'loading' : ''}" close.call="removeModal()" add.call="create(newAlertUrl)"></add-source>
    </div>
</template>
